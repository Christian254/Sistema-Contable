{% extends "Base/base.html" %}
{% block Titulo %}
Costeo metodo costo promedio
{% endblock Titulo %}
{% block Contenido %}
{% if user.is_authenticated %}
<br><br>
<label for="detalle" class="bg-danger"> REVISAR NO SE PARA QUE SIRVE</label>
<input id="detalle" type="submit" value="Administrar kardex" onclick="CrearCuenta()" />
{% if kardex1.tipo == 'PP'%}
<div class="container">
    <h2 class="text-center">Datos de kardex</h2>
    <form method="POST" action="">
        {% csrf_token %}
        <div class="row">
            <div class="col">
                <label>fecha:</label>
                <input type="date" name="fechaE" id="fechaE" required="" class="form-control">
            </div>
            <div class="col">
                <label>Cantidad</label>
                <input type="number" name="cantidadE" id="cantidadE" required="" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col">
                <label>Precio Unitario:</label>
                <input type="number" name="precioE" id="precioE" step="0.01" required="" class="form-control">
            </div>
            <div class="col">
                <label>Pago en: </label>
                <select name="cuenta" id="cuenta" class="form-control">
                    <option value="AC000">Efectivo </option>
                    <option value="PC000">Credito</option>
                    <option value="AC004">saco de inventario</option>
                </select>
            </div>
        </div>
        <br>
        <div class="row justify-content-center">
            <button type="submit" class="btn btn-outline-success">
                <i class="fas fa-cart-plus"></i> Ingresar
            </button>
            <input type="hidden" name="action" id="action" value="insert">
        </div>
    </form>
</div>
<br>
<div class="container">
    <h2 class="text-center">Enviar orden de fabricaci√≥n</h2>
    <form method="POST" action="">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-6 col-lg-4">
                <label>fecha:</label>
                <input type="date" name="fechaS" id="fechaS" required="" class="form-control">
            </div>
            <div class="col-md-6 col-lg-3">
                <label>Cantidad</label>
                <input type="number" name="cantidadS" id="cantidadS" required="" class="form-control">
            </div>
            <div class="col-md-12 col-lg-5">
                <label>Enviar a orden de fabricacion NO terminada aun: </label>
                <select name="PP" id="PP" class="form-control">
                    {% for p in prodPP %}
                    <option value="{{p.codCuenta}}">{{p.cuenta}} </option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <br>
        <div class="row justify-content-center">
            <input type="hidden" name="action" id="action" value="delete">
            <button type="submit" name="btn" id="btn" class="btn btn-outline-danger"><i class="fas fa-minus-circle"></i> Sacar</button>
        </div>
    </form>
</div>
<br>
<div id="container">
    <h2 class="text-center">Costo</h2>
    <form method="POST" action="">
        {% csrf_token %}
        <div class="row justify-content-center">
            <input type="hidden" name="action" id="action" value="calcular"><br>
            <button type="submit" name="btn" id="btn" class="btn btn-outline-info"><i class="fas fa-calculator"></i> Calcular</button>
        </div>
    </form>
    <h5 class="text-center">Costo de lo vendido y mercaderia disponible</h5>
    <form>
        <div class="form-group">
            <label>Inventario final:</label>
            <input type="text" class="form-control" value="{{final.montoExistencia}}" readonly>
        </div>
        <div class="form-group">
            <label>Cantidad en existencia:</label>
            <input type="text" class="form-control" value="{{final.cantExistencia}}" readonly>
        </div>
        <div class="form-group">
            <label>Costo de lo vendido:</label>
            <input type="text" class="form-control" value="{{CV}}" readonly>
        </div>
        <div class="form-group">
            <label>Mercaderia disponible:</label>
            <input type="text" class="form-control" value="{{MD}}" readonly>
        </div>
    </form>
    <a href="/kardex" class="btn btn-outline-info"><i class="fas fa-arrow-circle-left"></i> Regresar</a>
</div>
{% else %}
<div class="container">
    <h2 class="text-center" sty>Ingresar</h2>
    <form method="POST" action="">
        <input type="hidden" name="action" id="action" value="ordenfab">
        {% csrf_token %}
        <div class="row">
            <div class="col-3">
                <label>fecha:</label>
                <input type="date" name="fechaO" id="fechaO" required="" class="form-control">
            </div>
            <div class="col-6">
                <label>Q de productos de la OF</label>
                <label>Cantidad</label>
                <input type="number" name="cantidadO" id="cantidadO" required="" class="form-control"><br>
            </div>
            <div class="col-3">
                <label>viene de: </label>
                <select name="PT" id="PT" required="" class="form-control">
                    {% for p in prodPT %}
                    {% if p.saldo > 0 %}
                    <option value="{{p.codCuenta}}">{{p.cuenta}} a un costo total: $ {{p.saldo}} </option>
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="row justify-content-center">
            <button type="submit" name="btn" id="btn" class="btn btn-outline-success">
                <i class="fas fa-cart-plus"></i> Ingresar
            </button>
        </div>
    </form>
</div>
<br>
<div class="container">
    <h2 class="text-center" sty>Vender</h2>
    <form method="POST" action="">
        {% csrf_token %}
        <div class="row">
            <div class="col">
                <input type="hidden" name="action" id="action" value="vender">
                <label>Fecha:</label><br>
                <input class="form-control" type="date" name="fechaV" id="fechaV" required="">
            </div>
            <div class="col">
                <label>Cantidad</label><br>
                <input class="form-control" type="number" name="cantidadV" id="cantidadV" required="">
            </div>
        </div>
        <div class="row">
            <div class="col">
                <label>Margen de ganacia entre 0 y 100%</label><br>
                <input class="form-control" type="number" name="ganancia" id="ganancia" required="" max="100" min="0">
            </div>
            <div class="col">
                <label>Vender A: </label><br>
                <select name="PT" id="PT" class="form-control">
                    <option value="AC000">Efectivo</option>
                    <option value="AC001">Cuentas por cobrar</option>
                    <option value="AF000">Documentos por cobrar</option>
                </select>
            </div>
        </div>
        <br>
        <div class="row justify-content-center">
            <button type="submit" name="btn" id="btn"  class="btn btn-outline-primary">
                <i class="fas fa-clipboard-check"></i> Vender
            </button>
        </div>
    </form>
</div>
{% endif %}
<section class="container" style="margin-top:2%;height:auto;">
    <div id="form-detalle">
        <div class="tabla-0">
            <table class="table table-hover">
                <caption class="titulo-0">Kardex: metodo costo promedio {{i}}</caption>
                <thead class="bg-info">
                    <th style="background-color: #3d5c5c;" colspan="3">Entrada</th>
                    <th style="background-color: #3d5c5c;" colspan="3">Salida</th>
                    <th style="background-color: #3d5c5c;" colspan="3">Existencia </th>
                    <th style="background-color: #3d5c5c;" colspan="3" </th> </tr> <tr>
                    <th style="padding-left: 20px; padding-right: 20px;">Fecha</th>
                    <th style="padding-left: 20px; padding-right: 20px;">cantidad</th>
                    <th style="padding-left: 20px; padding-right: 20px;">Prec. Unitario</th>
                    <th style="padding-left: 20px; padding-right: 20px;">Monto</th>
                    <th style="padding-left: 20px; padding-right: 20px;">cantidad</th>
                    <th style="padding-left: 20px; padding-right: 20px;">Prec. Unitario</th>
                    <th style="padding-left: 20px; padding-right: 20px;">Monto</th>
                    <th style="padding-left: 20px; padding-right: 20px;">cantidad</th>
                    <th style="padding-left: 20px; padding-right: 20px;">Prec. Unitario</th>
                    <th style="padding-left: 20px; padding-right: 20px;">Monto</th>
                </thead>
                {% for existencia in kardex.all %}
                <tr>
                    <td style="padding-left: 20px; padding-right: 20px;"> {{existencia.fecha}} </td>
                    <td style="padding-left: 20px; padding-right: 20px;"> {{existencia.cantEntrada}} </td>
                    <td style="padding-left: 20px; padding-right: 20px;"> {{existencia.precEntrada}} </td>
                    <td style="padding-left: 20px; padding-right: 20px;">{{existencia.montoEntrada}} </td>
                    <td style="padding-left: 20px; padding-right: 20px;"> {{existencia.cantSalida}} </td>
                    <td style="padding-left: 20px; padding-right: 20px;"> {{existencia.precSalida}} </td>
                    <td style="padding-left: 20px; padding-right: 20px;">{{existencia.montoSalida}} </td>
                    <td style="padding-left: 20px; padding-right: 20px;"> {{existencia.cantExistencia}} </td>
                    <td style="padding-left: 20px; padding-right: 20px;"> {{existencia.precExistencia}} </td>
                    <td style="padding-left: 20px; padding-right: 20px;">{{existencia.montoExistencia}} </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</section>
{% endif %}
{% endblock Contenido %}